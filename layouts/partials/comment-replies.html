{{ $.Scratch.Set "hasReplies" 0 }}
{{ range $index, $comments := (index $.comments_parent $.slug_parent ) }}
  {{ if eq .reply_to $._id_parent }}
    {{ $.Scratch.Add "hasReplies" 1 }}
    <div class="comment-reply">
      <div class="comment-header">
        <img class="comment-avatar" src="https://www.gravatar.com/avatar/{{ .email }}?s=36">
        <p class="comment-author"><strong>{{ .name }}</strong><br><i><small>In reply to {{ $.name_parent }}</i></small><br>
        <span class="comment-timestamp"><time datetime="{{ .date }}">{{ dateFormat (default (i18n "shortdateFormat") .Site.Params.dateformat) .date }}</time></span></p>
      </div>
      <div class="comment-content"><p>{{ .comment | markdownify }}</p></div>
      <p>{{ $.Scratch.Get "hasReplies" }}</p>
    </div>
  {{ end }}
  {{ if gt ($.Scratch.Get "hasReplies") 0 }}
    <div class="comment-reply-btn">
      <a id="{{ ._id }}" class="btn-info" href="#comment-form" onclick="changeValue('fields[reply_to]', '{{ ._id }}')">Reply to Thread</a>
    </div>
  {{ end }}
{{ end }}
